# File: worker/Dockerfile
# --------------------------------------------------------------------------
# Use an explicit Arm-native (arm64/aarch64) base image for native compilation.
# Using 'bookworm-arm64' ensures full Arm compatibility for dependencies.
FROM python:3.11-slim-bookworm-arm64

# Set up the working directory
WORKDIR /app

# Install necessary system dependencies (e.g., for data science libraries)
# The use of 'apt-get' inside this Arm container will pull Arm64 packages.
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    build-essential \
    libpq-dev \
    gcc \
    && rm -rf /var/lib/apt/lists/*

# Copy the requirements file and install Python packages
# Packages like numpy, pandas, etc., will install their Arm-optimized wheels here.
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy the rest of the application code
COPY . .

# Command to run the stream processing worker
CMD ["python", "realtime_processor.py"]